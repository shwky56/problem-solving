{"title":{"en":"F. Bugaboo","ru":"F. Бугабу"},"contestId":"1707","problemIndex":"F","timeLimit":{"en":"2 seconds","ru":"2 секунды"},"memLimit":{"en":"1024 megabytes","ru":"1024 мегабайта"},"inputFormat":{"en":"standard input","ru":"стандартный ввод"},"outputFormat":{"en":"standard output","ru":"стандартный вывод"},"problemHtml":{"en":"<p>A transformation of an array of positive integers $$$a_1,a_2,\\dots,a_n$$$ is defined by replacing $$$a$$$ with the array $$$b_1,b_2,\\dots,b_n$$$ given by $$$b_i=a_i\\oplus a_{(i\\bmod n)+1}$$$, where $$$\\oplus$$$ denotes the bitwise XOR operation.</p><p>You are given integers $$$n$$$, $$$t$$$, and $$$w$$$. We consider an array $$$c_1,c_2,\\dots,c_n$$$ ($$$0 \\le c_i \\le 2^w-1$$$) to be <span class=\"tex-font-style-it\">bugaboo</span> if and only if there exists an array $$$a_1,a_2,\\dots,a_n$$$ such that after transforming $$$a$$$ for $$$t$$$ times, $$$a$$$ becomes $$$c$$$.</p><p>For example, when $$$n=6$$$, $$$t=2$$$, $$$w=2$$$, then the array $$$[3,2,1,0,2,2]$$$ is bugaboo because it can be given by transforming the array $$$[2,3,1,1,0,1]$$$ for $$$2$$$ times:</p><p>$$$$$$ [2,3,1,1,0,1]\\to [2\\oplus 3,3\\oplus 1,1\\oplus 1,1\\oplus 0,0\\oplus 1,1\\oplus 2]=[1,2,0,1,1,3]; \\\\ [1,2,0,1,1,3]\\to [1\\oplus 2,2\\oplus 0,0\\oplus 1,1\\oplus 1,1\\oplus 3,3\\oplus 1]=[3,2,1,0,2,2]. $$$$$$</p><p>And the array $$$[4,4,4,4,0,0]$$$ is not bugaboo because $$$4 &gt; 2^2 - 1$$$. The array $$$[2,3,3,3,3,3]$$$ is also not bugaboo because it can't be given by transforming one array for $$$2$$$ times.</p><p>You are given an array $$$c$$$ with some positions lost (only $$$m$$$ positions are known at first and the remaining positions are lost). And there are $$$q$$$ modifications, where each modification is changing a position of $$$c$$$. A modification can possibly change whether the position is lost or known, and it can possibly redefine a position that is already given.</p><p>You need to calculate how many possible arrays $$$c$$$ (with arbitrary elements on the lost positions) are bugaboos after each modification. Output the $$$i$$$-th answer modulo $$$p_i$$$ ($$$p_i$$$ is a given array consisting of $$$q$$$ elements).</p>","ru":"<p>Трансформация массива положительных целых чисел $$$a_1,a_2,\\dots,a_n$$$ определена как замена $$$a$$$ на массив $$$b_1,b_2,\\dots,b_n$$$, получающийся операцией $$$b_i=a_i\\oplus a_{(i\\bmod n)+1}$$$, где $$$\\oplus$$$ обозначает операцию побитового XOR (исключающего ИЛИ).</p><p>Вам даны целые числа $$$n$$$, $$$t$$$ и $$$w$$$. Мы считаем, что массив $$$c_1,c_2,\\dots,c_n$$$ ($$$0 \\le c_i \\le 2^w-1$$$) является <span class=\"tex-font-style-it\">бугабу</span> тогда и только тогда, когда существует массив $$$a_1,a_2,\\dots,a_n$$$ такой, что после трансформации массива $$$a$$$ ровно $$$t$$$ раз массив $$$a$$$ превращается в $$$c$$$.</p><p>Например, если $$$n=6$$$, $$$t=2$$$, $$$w=2$$$, то массив $$$[3,2,1,0,2,2]$$$&nbsp;— бугабу, потому что его можно получить, трансформировав массив $$$[2,3,1,1,0,1]$$$ $$$2$$$ раза: $$$$$$ [2,3,1,1,0,1]\\to [2\\oplus 3,3\\oplus 1,1\\oplus 1,1\\oplus 0,0\\oplus 1,1\\oplus 2]=[1,2,0,1,1,3]; \\\\ [1,2,0,1,1,3]\\to [1\\oplus 2,2\\oplus 0,0\\oplus 1,1\\oplus 1,1\\oplus 3,3\\oplus 1]=[3,2,1,0,2,2]. $$$$$$</p><p>Массив $$$[4,4,4,4,0,0]$$$ не бугабу, потому что $$$4 &gt; 2^2 - 1$$$. Массив $$$[2,3,3,3,3,3]$$$ не бугабу, потому что он не может быть получен трансформацией одного массива $$$2$$$ раза.</p><p>Вам дан массив $$$c$$$, значения на некоторых позициях которого неизвестны (вначале только $$$m$$$ элементов известны, остальные&nbsp;— нет). Также есть $$$q$$$ модификаций, где каждая модификация меняет какой-либо элемент $$$c$$$. Модификация может изменить, известен ли элемент на какой-либо позиции или нет, а так же, возможно, переопределить элемент на позиции, которая уже известна.</p><p>Вам нужно посчитать, сколько возможных массивов $$$c$$$ (с произвольными элементами на неизвестных позициях) являются бугабу после каждой модификации. Выведите $$$i$$$-й ответ по модулю $$$p_i$$$ ($$$p_i$$$&nbsp;— заданный массив из $$$q$$$ элементов).</p>"},"inSpecsHtml":{"en":"<div class=\"section-title\">Input</div><p>The first line contains four integers $$$n$$$, $$$m$$$, $$$t$$$ and $$$w$$$ ($$$2\\le n\\le 10^7$$$, $$$0\\le m\\le \\min(n, 10^5)$$$, $$$1\\le t\\le 10^9$$$, $$$1\\le w\\le 30$$$).</p><p>The $$$i$$$-th line of the following $$$m$$$ lines contains two integers $$$d_i$$$ and $$$e_i$$$ ($$$1\\le d_i\\le n$$$, $$$0\\le e_i&lt; 2^w$$$). It means the position $$$d_i$$$ of the array $$$c$$$ is given and $$$c_{d_i}=e_i$$$. It is guaranteed that $$$1\\le d_1&lt;d_2&lt;\\ldots&lt;d_m\\le n$$$.</p><p>The next line contains only one number $$$q$$$ ($$$1\\le q\\le 10^5$$$)&nbsp;— the number of modifications.</p><p>The $$$i$$$-th line of the following $$$q$$$ lines contains three integers $$$f_i$$$, $$$g_i$$$, $$$p_i$$$ ($$$1\\le f_i\\le n$$$, $$$-1\\le g_i&lt; 2^w$$$, $$$11\\le p_i\\le 10^9+7$$$). The value $$$g_i=-1$$$ means changing the position $$$f_i$$$ of the array $$$c$$$ to a lost position, otherwise it means changing the position $$$f_i$$$ of the array $$$c$$$ to a known position, and $$$c_{f_i}=g_i$$$. The value $$$p_i$$$ means you need to output the $$$i$$$-th answer modulo $$$p_i$$$.</p>","ru":"<div class=\"section-title\">Входные данные</div><p>Первая строка содержит четыре целых числа $$$n$$$, $$$m$$$, $$$t$$$ и $$$w$$$ ($$$2\\le n\\le 10^7$$$, $$$0\\le m\\le \\min(n, 10^5)$$$, $$$1\\le t\\le 10^9$$$, $$$1\\le w\\le 30$$$).</p><p>Затем следуют $$$m$$$ строк, $$$i$$$-я из которых содержит два целых числа $$$d_i$$$ и $$$e_i$$$ ($$$1\\le d_i\\le n$$$, $$$0\\le e_i&lt; 2^w$$$), означающие, что позиция $$$d_i$$$ массива $$$c$$$ известна и $$$c_{d_i}=e_i$$$. Гарантируется, что $$$1\\le d_1&lt;d_2&lt;\\ldots&lt;d_m\\le n$$$.</p><p>Следующая строка содержит одно число $$$q$$$ ($$$1\\le q\\le 10^5$$$)&nbsp;— количество модификаций.</p><p>Затем следуют $$$q$$$ строк, $$$i$$$-я из которых содержит три целых числа $$$f_i$$$, $$$g_i$$$, $$$p_i$$$ ($$$1\\le f_i\\le n$$$, $$$-1\\le g_i&lt; 2^w$$$, $$$11\\le p_i\\le 10^9+7$$$). Значение $$$g_i=-1$$$ означает пометку позиции $$$f_i$$$ массива $$$c$$$ как неизвестной, иначе пометку позиции $$$f_i$$$ массива $$$c$$$ как известной, причем $$$c_{f_i}=g_i$$$. Значение $$$p_i$$$ означает, что вы должны вывести $$$i$$$-й ответ по модулю $$$p_i$$$.</p>"},"outSpecsHtml":{"en":"<div class=\"section-title\">Output</div><p>The output contains $$$q$$$ lines, denoting your answers.</p>","ru":"<div class=\"section-title\">Выходные данные</div><p>Выведите $$$q$$$ строк&nbsp;— ваши ответы.</p>"},"noteHtml":{"en":"<div class=\"section-title\">Note</div><p>In the first example, $$$n=3$$$, $$$t=1$$$, and $$$w=1$$$. Let $$$?$$$ denote a lost position of $$$c$$$.</p><p>In the first query, $$$c=[1,0,1]$$$. The only possible array $$$[1,0,1]$$$ is bugaboo because it can be given by transforming $$$[0,1,1]$$$ once. So the answer is $$$1\\bmod 123\\,456\\,789 = 1$$$.</p><p>In the second query, $$$c=[1,1,1]$$$. The only possible array $$$[1,1,1]$$$ is not bugaboo. So the answer is $$$0\\bmod 111\\,111\\,111 = 0$$$.</p><p>In the third query, $$$c=[?,1,1]$$$. There are two possible arrays $$$[1,1,1]$$$ and $$$[0,1,1]$$$. Only $$$[0,1,1]$$$ is bugaboo because it can be given by transforming $$$[1,1,0]$$$ once. So the answer is $$$1\\bmod 987\\,654\\,321=1$$$.</p><p>In the fourth query, $$$c=[?,1,?]$$$. There are four possible arrays. $$$[0,1,1]$$$ and $$$[1,1,0]$$$ are bugaboos. $$$[1,1,0]$$$ can be given by performing $$$[1,0,1]$$$ once. So the answer is $$$2\\bmod 555\\,555\\,555=2$$$.</p>","ru":"<div class=\"section-title\">Примечание</div><p>В первом примере $$$n=3$$$, $$$t=1$$$ и $$$w=1$$$. Пусть $$$?$$$ обозначает неизвестную позицию в массиве $$$c$$$.</p><p>В первом запросе $$$c=[1,0,1]$$$. Единственный возможный массив $$$[1,0,1]$$$&nbsp;— бугабу, потому что он может быть получен одной трансформацией из $$$[0,1,1]$$$. Поэтому ответ $$$1\\bmod 123\\,456\\,789 = 1$$$.</p><p>Во втором запросе $$$c=[1,1,1]$$$. Единственный возможный массив $$$[1,1,1]$$$&nbsp;— не бугабу. Поэтому ответ $$$0\\bmod 111\\,111\\,111 = 0$$$.</p><p>В третьем запросе $$$c=[?,1,1]$$$. Есть два возможных массива: $$$[1,1,1]$$$ и $$$[0,1,1]$$$. Из них только $$$[0,1,1]$$$ является бугабу, потому что может быть получен одной трансформацией из $$$[1,1,0]$$$. Поэтому ответ $$$1\\bmod 987\\,654\\,321=1$$$.</p><p>В четвертом запросе $$$c=[?,1,?]$$$. Есть четыре возможных массива, из них $$$[0,1,1]$$$ и $$$[1,1,0]$$$ являются бугабу. $$$[1,1,0]$$$ может быть получен из $$$[1,0,1]$$$ одной трансформацией. Поэтому ответ $$$2\\bmod 555\\,555\\,555=2$$$.</p>"},"sampleTestcases":[{"id":1658236339601,"input":"3 2 1 1\n1 1\n3 1\n4\n2 0 123456789\n2 1 111111111\n1 -1 987654321\n3 -1 555555555\n","output":"1\n0\n1\n2\n"},{"id":1658236339602,"input":"24 8 5 4\n4 4\n6 12\n8 12\n15 11\n16 7\n20 2\n21 9\n22 12\n13\n2 13 11\n3 15 12\n5 7 13\n9 3 14\n10 5 15\n11 15 16\n13 14 17\n14 1 18\n18 9 19\n19 6 20\n23 10 21\n24 8 22\n21 13 23\n","output":"1\n4\n9\n2\n1\n0\n1\n10\n11\n16\n16\n0\n16\n"}],"submitUrl":"https://codeforces.com/problemset/submit","language":"c++","langId":"61"}